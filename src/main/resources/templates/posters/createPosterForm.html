<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<h1 th:text="|현재 카테고리: ${category}|"></h1> <br>
<div class="d-flex justify-content-center">
    <form class="w-50 h-50" th:action="@{|/posters/${category}|}" method="post" th:object="${poster}" enctype="multipart/form-data">
        <div class="form-floating">
            <input class="form-control" placeholder="제목" type="text" name="title" th:field="*{title}">
            <label>제목</label>
            <span th:errors="*{title}"></span><br>
        </div>

        <div class="form-floating">
            <input class="form-control" placeholder="작성자" type="text" name="writer" th:field="*{writer}">
            <label>작성자</label>
            <span th:errors="*{writer}"></span><br>
        </div>

        <div class="form-floating">
        <textarea class="form-control" placeholder="내용" type="text" name="content" th:field="*{content}"
                  style="height: 100px"></textarea>
            <label>내용</label>
            <span th:errors="*{content}"></span><br>
        </div>

        <input type="file" name="files" multiple="multiple" onchange="test(this.files)">
        <div id="file-list">
        </div>
        <div class="d-flex justify-content-end">
            <button type="button" class="btn btn-primary mx-1" th:onclick="|location.href='@{|/posters/${category}|}'|">취소</button>
            <button class="btn btn-primary" type="submit">제출</button>
        </div>
    </form>
</div>
</body>
<script src="/js/bootstrap.min.js"></script>
<script>

    let selectedFiles = [];

    function test(files) {
        console.log(files);
        const fileList = document.getElementById('file-list');
        for(let i=0; i<files.length; i++) {
            selectedFiles.push(files[i]);
            const item = document.createElement('div');
            const fileName = document.createTextNode(files[i].name);
            const deleteButton = document.createElement('button');
            deleteButton.addEventListener('click', (event) => {
                item.remove();
                event.preventDefault();
                deleteFile(files[i]);
            });
            deleteButton.innerText="X";
            item.appendChild(fileName);
            item.appendChild(deleteButton);
            fileList.appendChild(item);
        }
    }

    function deleteFile(deleteFile) {
        const inputFile = document.querySelector('input[name="files"]');
        const dataTransfer = new DataTransfer();
        selectedFiles = selectedFiles.filter(file => file!==deleteFile);
        selectedFiles.forEach(file => {
            dataTransfer.items.add(file);
        })
        inputFile.files = dataTransfer.files;
    }
</script>
</html>